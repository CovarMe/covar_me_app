{% extends "layout.html" %}

{% block title %}Portfolio{% endblock %}

{% block top_imports %}
<script src="{{ url_for('bower.static', filename='plotly/plotly.js') }}"></script>
<script src="{{ url_for('bower.static', filename='plotly/plotly.js') }}"></script>
<script src="{{ url_for('bower.static', filename='vis/dist/vis.js') }}"></script>
<link href="{{ url_for('bower.static', filename='vis/dist/vis.css')}}"/>
{% endblock %}

{% block body %}
<body>

  <section class="bck white padding text center">
    <h1>Hello {{ username }}!</h1>
    <p>Stats for your portfolio: {{ name }}</p>
  </section>

  <section class="bck white padding text center">
    <!-- Return vs. Variance curve -->
    <div class="row padding-bottom">
      <div class="column_10 offset_1">
        <h2>Return vs. Risk</h2>
        <div id="ret-vs-var-graph" style="width:100%;height:550px;"></div>
        <script>
var layout = {
  paper_bgcolor: "rgb(255,255,255)", 
  plot_bgcolor: "rgb(229,229,229)", 
  xaxis: {
    gridcolor: "rgb(255,255,255)", 
    range: [1, 10], 
    showgrid: true, 
    showline: false, 
    showticklabels: true, 
    tickcolor: "rgb(127,127,127)", 
    ticks: "outside", 
    zeroline: false
  }, 
  yaxis: {
    gridcolor: "rgb(255,255,255)", 
    showgrid: true, 
    showline: false, 
    showticklabels: true, 
    tickcolor: "rgb(127,127,127)", 
    ticks: "outside", 
    zeroline: false
  }
};
Plotly.plot('ret-vs-var-graph', {{ data.charts.ret_vs_var|tojson }}, layout);
        </script>
      </div>
    </div>
  </section>

  <section class="bck white padding text center">
    <!-- Portfolio Noise -->
    <div class="row padding-bottom">
      <div class="column_10 offset_1">
        <h2>Portfolio Returns</h2>
        <div id="noise-graph" style="width:100%;height:550px;"></div>
        <script>
var layout = {
  paper_bgcolor: "rgb(255,255,255)", 
  plot_bgcolor: "rgb(229,229,229)", 
  xaxis: {
    gridcolor: "rgb(255,255,255)", 
    showgrid: true, 
    showline: false, 
    showticklabels: true, 
    tickcolor: "rgb(127,127,127)", 
    ticks: "outside", 
    zeroline: false
  }, 
  yaxis: {
    gridcolor: "rgb(255,255,255)", 
    showgrid: true, 
    showline: false, 
    showticklabels: true, 
    tickcolor: "rgb(127,127,127)", 
    ticks: "outside", 
    zeroline: false
  }
};
Plotly.plot('noise-graph', {{ data.charts.noise|tojson }}, layout);
        </script>
      </div>
    </div>
  </section>

  <section class="bck white padding text center">
    <!-- Portfolio Covariance Heatmap -->
    <div class="row padding-bottom">
      <div class="column_10 offset_1">
        <h2>Portfolio Covariance</h2>
        <div id="covar-heatmap-graph" style="width:100%;height:550px;"></div>
        <script>
Plotly.newPlot('covar-heatmap-graph', {{ data.charts.covar_heatmap|tojson }});
        </script>
      </div>
    </div>
  </section>


  <section class="bck white padding text center">
    <!-- Portfolio Network -->
    <div class="row padding-bottom">
      <div class="column_10 offset_1">
        <h2>Portfolio Network</h2>
        <div id="portfolio-network" style="width:100%;height:550px;"></div>
        <script type="text/javascript">
// create an array with nodes
var nodes = new vis.DataSet([
    {id: 1, label: 'Node 1'},
    {id: 2, label: 'Node 2'},
    {id: 3, label: 'Node 3'},
    {id: 4, label: 'Node 4'},
    {id: 5, label: 'Node 5'}
]);

// create an array with edges
var edges = new vis.DataSet([
    {from: 1, to: 3},
    {from: 1, to: 2},
    {from: 2, to: 4},
    {from: 2, to: 5}
]);

// create a network
var container = document.getElementById('portfolio-network');

// provide the data in the vis format
var data = {
  nodes: nodes,
  edges: edges
};
var options = {};

// initialize your network!
var network = new vis.Network(container, data, options);
        </script>

      </div>
    </div>
  </section>


  <!--
    <section class="bck white padding text center">
    <div class="row padding-bottom">
    <div class="column_10 offset_1">
    <h2>Portfolio Covariance Details</h2>
    <div id="covar-detail-graph" style="width:100%;height:550px;"></div>
    <script>
var graphDiv = document.getElementById('covar-detail-graph');
var N = 1000;
var color1 = '#7b3294';
var color1Light = '#c2a5cf';
var colorX = '#ffa7b5';
var colorY = '#fdae61';

function randomArray() {
  var out = new Array(N);
  for(var i = 0; i < N; i++) {
    out[i] = Math.random();
  }
  return out;
}
var x = randomArray();
var y = randomArray();

Plotly.plot(graphDiv, [{
  type: 'scatter',
  mode: 'markers',
  x: x,
  y: y,
  xaxis: 'x',
  yaxis: 'y',
  name: 'random data',
  marker: {color: color1, size: 10}
}, {
  type: 'histogram',
  x: x,
  xaxis: 'x2',
  yaxis: 'y2',
  name: 'x coord dist.',
  marker: {color: colorX}
}, {
  type: 'histogram',
  x: y,
  xaxis: 'x3',
  yaxis: 'y3',
  name: 'y coord dist.',
  marker: {color: colorY}
}], {
  title: 'Lasso around the scatter points to see sub-distributions',
  dragmode: 'lasso',
  xaxis: {
    zeroline: false,
  },
  yaxis: {
    domain: [0.55, 1],
  },
  xaxis2: {
    domain: [0, 0.45],
    anchor: 'y2',
  },
  yaxis2: {
    domain: [0, 0.45],
    anchor: 'x2'
  },
  xaxis3: {
    domain: [0.55, 1],
    anchor: 'y3'
  },
  yaxis3: {
    domain: [0, 0.45],
    anchor: 'x3'
  }
});

graphDiv.on('plotly_selected', function(eventData) {
  var x = [];
  var y = [];

  var colors = [];
  for(var i = 0; i < N; i++) colors.push(color1Light);

  console.log(eventData.points)

    eventData.points.forEach(function(pt) {
      x.push(pt.x);
      y.push(pt.y);
      colors[pt.pointNumber] = color1;
    });

  Plotly.restyle(graphDiv, {
    x: [x, y],
    xbins: {}
  }, [1, 2]);

  Plotly.restyle(graphDiv, 'marker.color', [colors], [0]);
});
    </script>
    </div>
    </div>
    </section>
    -->

</body>
{% endblock %}

